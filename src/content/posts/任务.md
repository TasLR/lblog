---
title: 任务
published: 2024-07-16
description: ''
image: ''
tags: [freeRTOS]
category: RTOS
draft: false 
---
# Task

## 基本属性

### 状态

- 运行态
- 非运行态
- 阻塞态
- 就绪态
- 挂起
- 状态转化

### 分类

- 事件驱动任务（等待事件触发）
- 周期性任务（使用了TaskDelay（）等函数）
- 持续性任务，可以执行完整的时间片（无任何阻塞，高优先级任务会导致其他任务无法得到执行）

### 任务调度

#### 任务调度算法

- 固定优先级（Fixed priority）,不改变被调度的任务优先级
- 抢占（pre-emptive），任务优先级高者抢占cpu资源
- 时间片（time slicing）轮转，在同优先级任务间共享处理器时间，这些任务未显式yield（主动放弃时间片）或block，若有同级任务处于就绪，则在时间片结束时选择新的任务进入run态

#### 应用

1. 带时间片的抢占调度（若有更高优先级的任务ready，则将其转为run状态）

- 应用中所有任务优先级唯一，高优先级抢占低优先级
- 应用中任务优先级相同，同级任务轮流执行，因此一个时间片内可能存在多个任务

1. 不带时间片的抢占调度

- 同优先级任务不共享处理时间
- 选择新的ready态中最高优先级任务进入run态
- 用于更少的任务上下文切换，可减少调度器的处理花销，但也会导致同级任务获得不同的处理时间，故而该模式被视为高级技术给体验用户使用
- 同类（同优先级，任务属性同）任务，只有被更高级任务抢占后才会发生轮换运行

1. 协同调度

- 上下文切换只出现在run态任务调用taskYIELD显式请求重新调度或者run态任务转为block态任务，否则任务会一直运行
- 任务不会发生抢占，故时间片不可用
- 都任务应用中用于限定一个资源不会被超过一个任务使用

1. 协同调度较之抢占调度

- 抢占调度中，运行态任务可能在任何时刻被抢占，包括当一个资源被其他任务共享，处于不协调的状态时
- 使用协同调度，应用编写者可控制何时切换到其他任务，进而保证共享资源处于不协调状态时，不会发生任务切换
- 较之使用抢占调度，使用协作调度系统会有更低响应
- 使用哪个抢占调度，调度器会立刻运行就绪态中最高优先级任务，这个也是实时操作系统的本质--必须响应高优先级事件
- 使用协同调度，就绪态中较高优先级任务不会进入就绪态，直至运行态任务阻塞或显式放弃处理器资源(yield)