---
title: 任务通知
published: 2024-07-16
description: ''
image: ''
tags: [freeRTOS]
category: RTOS
draft: false 
---
## notify

> 无需中间对象，直接于其他任务交互

1. 一个任务的通知状态和通知值

   - state：pending(收到notification)和not pending
   - 通知值

2. 如何及何时一个任务通知可悲用于替代通信对象，如信号量

   - 只有一个接收任务请求资源
   - 一次只传递单个信号
   - 不存在发送方需要阻塞等待发送数据
   - 接收源不是中断

3. 使用任务通知的优点，在替代通信对象（队列、信号量等）的场景下

### 优点

1. 轻量快速
2. 占用资源少
3. 将事件从任务发送到任务比使用队列等更快速
4. 低RAM用量，队列等使用前需先创建，而任务通知功能在每个任务上只占8字节的RAM

### 缺点（限制）

- 发送一个事件或数据到中断，队列等可以，任务通知不行
- 无法应用于多个接收任务（广播），一个通信对象可被任何任务或中断访问，任意数量的任务和中断可以处理被发送到通信对象的事件和数据，任务通知直接发送到接收任务，并只能被该任务处理，然，通常情况下是多个任务或中断发送到同一个通信对象，很少有多个任务或中断从同一个通信对象中接收
- 缓冲多个数据项，其他通信对象如队列，一次发送多项数据，通知一次只有一个值，任务通知通过更新接收任务的通知值来发送数据，该值一次只有一个值
- 一次发送完整数据后需阻塞等待（阻塞等待至最终写入发送完成）的场景，如队列的使用，而若一个任务试图发送一个通知到一个已经存在通知的任务时，发送任务不会为等待接收任务重置自己的接收通知状态而阻塞等待（任务通知会直接覆盖未被处理的通知）

- 通知会将通知值增加，故为了保证所有事件被处理，每次处理完一个事件对通知值做减法，在任务中设置调用退出了清零

1. 替代的场景
   1. 增加到接收任务的通知值，等效简化版API
   2. 设置一个或多个bit到接收任务通知值，轻量、快速版事件组
   3. 写全新的数到接收任务通知值，因而该值为最后更新的且被任务读取、长度为1的队列替代版
   4. 写全新的数到接收任务通知值，该值为最新值且未被接收任务读取，邮箱的替代版本
   5. 替代信号量，通过对应的通知值来记录待处理事件的数量
   6. 高级版本的通知发送API
2. 具体应用